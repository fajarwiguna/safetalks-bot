# 🛡️ SafeTalks Discord Bot

**SafeTalks** is a real-time Discord moderation bot powered by an LSTM-based machine learning model. It detects **hate speech**, **offensive language**, and **neutral content** in messages, taking automated actions to maintain safe server environments.

---

## 🚀 Features

- 🔍 Real-time detection of toxic messages
  - Classifies messages as **Hate Speech**, **Offensive**, or **Neither**
  - Highlights high-confidence violations instantly

- ⚠️ Automated moderation system
  - 🧠 Deletes hate speech if confidence ≥ threshold
  - 👮 Warns users for offensive messages
  - 🔧 Thresholds configurable via `!set_threshold`

- 🗂️ Per-server violation logging
  - View recent logs with `!log [count]`
  - Admins can clear logs with `!clear_log <mode> [arg]`

- 🧼 Built-in text preprocessing
  - Cleans input text
  - Normalizes slang and casing for better model accuracy

- 🧪 Testable AI model
  - Use `!test <message>` to preview predictions
  - Shows confidence scores for all classes

- ⚙️ Modular command structure using Discord Cogs
- ☁️ Seamless deployment via [Fly.io](https://fly.io/)

---

## 🗂️ Project Structure

```
safetalks-bot/
├── main.py # Main bot entry point
├── commands/
│ ├── init.py # Package initializer
│ ├── help.py # !help command logic
│ ├── log.py # !log command logic
│ ├── clear_log.py # !log command logic
│ ├── test.py # !test command logic
│ └── threshold.py # !set_threshold command logic
├── utils/
│ ├── init.py # Package initializer
│ ├── clean.py # Text normalization and cleaning
│ ├── model_loader.py # Model and tokenizer loading
│ ├── predict.py # Prediction logic
│ └── logger.py # Logging moderation events
├── model/
│ ├── lstm_model.keras # Trained LSTM model
│ └── tokenizer.pkl # Fitted tokenizer
├── logs/
│ └── violations.csv # Saved violation logs (autogenerated)
├── .env # Environment variables (BOT_TOKEN)
├── requirements.txt # Python dependencies
└── README.md # This documentation
```

---

## 🧠 Model Overview

SafeTalks uses a custom LSTM model with:
- 🧠 **SimpleAttention** layer for enhanced token focus
- 🎯 **Focal Loss** function to handle class imbalance

**Classifications:**
- Hate Speech
- Offensive
- Neither

The model and tokenizer are stored in `model/`.

---

## ⚙️ Local Development

1. **Clone the repository:**
   ```bash
   git clone https://github.com/fajarwiguna/safetalks-bot.git
   cd safetalks-bot
   ```

2. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

3. **Configure environment:**
   Create a `.env` file with:
   ```
   BOT_TOKEN=your_discord_bot_token_here
   ```

4. **Run the bot:**
   ```bash
   python main.py
   ```

---

## ☁️ Deployment (Fly.io)

1. Push the project to a GitHub repository.
2. Visit [Fly.io](https://fly.io/)
3. Install the Fly CLI and run `fly launch`.
4. Set the `BOT_TOKEN` using fly secrets set `BOT_TOKEN=your_token_here.`
5. Run `fly deploy` to go live.

---

## 💬 Bot Commands

### `!help`
Displays available bot commands.

### `!test <text>`
Classifies input text and returns the prediction with confidence scores.

**Example:**
```bash
!test fuck you
```

### `!log [count]`
Displays recent moderation logs (default: 5, max: 20 entries).

**Examples:**
```bash
!log      # shows 5 recent logs
!log 10   # shows 10 most recent logs
```
### `!clear_log <mode> [arg]`
Clears violation logs. Admin-only command.

**Modes:**
- `all`: remove all logs for this server.
- `user <username>`: remove all logs for a specific user in this server.
- `last <n>`: remove the last `n` logs from this server.

**Examples:**
```bash
!clear_log all
!clear_log user <username>
!clear_log last 3
```

### `!set_threshold <label> <value>`
Adjusts the confidence threshold for triggering moderation.

- `label`: one of `hate`, `offensive`
- `value`: float between 0 and 1

**Example:**
```bash
!set_threshold hate 0.92
```

*Only available to server admins.*

---

## 🔐 Auto Moderation Rules

- **Hate Speech** (confidence ≥ 0.80): Message deleted, user warned
- **Offensive** (confidence ≥ 0.85): User warned
- **Neither**: No action taken

---

## 📜 License

Licensed under the [MIT License](LICENSE). Free to use, modify, and distribute.

---

## 🙋‍♂️ Contributing

Contributions are welcome! Submit pull requests or open issues for:
- Moderation dashboard
- Message logging with database integration
- Abuse reporting system

---

## 📬 Contact

**Developer:** Fajar Satria Wiguna  
📧 Email: [fajarsatria991@gmail.com](mailto:fajarsatria991@gmail.com)  